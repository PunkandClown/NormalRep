<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
</head>
    <style>
         .chatBox {
            height: 350px;
            width: 200px;
            display: flex;
            flex-direction: column-reverse;
            overflow-y: scroll;
        }

        .message {
            padding: 5px 10px;
            border: 1px solid gray;
        }
    </style>
<body>
    <form name="publish">
        <input type="text" name="message" />
        <input type="submit" value="Send" />
      </form>

    <div id="subMes" class="chatBox">
    </div>

</body>

    
<script>
    function Form(form) {

        function sendMes(message) {
            let xhr = new XMLHttpRequest();
            xhr.open('POST', 'http://10.1.0.48:1337/main', true);

            xhr.send(message);

        }

        form.onsubmit = function () {
            let message = form.message.value;

            console.log(message);
            if (message) {
                sendMes(message);
            }
            return false;
        }
    }

    function subMes (elem) {
        function sub() {
            let xhr = new XMLHttpRequest();

    //         xhr.onreadystatechange = function () {
    //             if (this.readyState != 4) return
                
    //             if (this.status == 200) {
    //             if (this.responseText) {
    //             // сервер может закрыть соединение без ответа при перезагрузке
    //             showMessage(this.responseText);
    //                 }
    //                 subMes();
    //             return;
    //             } 
    //             if (this.status != 502) {
    //     // 502 - прокси ждал слишком долго, надо пересоединиться, это не ошибка
    //     showMessage(this.statusText); // показать ошибку
    //   }

    //   setTimeout(subscribe, 1000); // попробовать ещё раз через 1 сек
    // }
    xhr.open("GET", 'http://10.1.0.48:1337/main', true);
    xhr.send();
  }

  subMes();

}


 // function onloadMes() {
    //     let key;

    //     let list = document.getElementById

    //         let content = JSON.parse(xhr.response);
            
    //         let newDiv = document.createElement('div');
    //         newDiv.className = 'message';

    //     for (key in content) {
    //                 newDiv.innerHTML = `
    //                 <li> 
    //                     <h4>${content[key].Name}</h4>
    //                     <h5>${content[key].Data}</h5>
    //                     <p>${content[key].TextMessage}</p> 
    //                 </li>
    //         `;
    //             }
    //             list.append(newDiv);
    // }

    // document.body.onload = function() {
    //     let xhr = new XMLHttpRequest;

    //     xhr.open("GET", "http://10.1.0.48:1337/main");

    //     xhr.onload = function () {
    //          onloadMes();
    //         }

    //     xhr.send();
    // }
            
    

    //     function start() {
    //         let xhr = new XMLHttpRequest();
    //         let messT = document.getElementById('btnst').value;

    //         xhr.open("POST", 'http://10.1.0.48:1337/main');

    //         xhr.onload = function () {
    //             onloadMes();
    //         }
    //         xhr.send(messT);
    //     }

    // new form(document.forms.publish, 'publish');
    

    </script>
</html>